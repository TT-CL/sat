<div #spinnerOrigin>
<mat-card class="document-card" *ngIf="doc">
  <mat-card-header>
    <mat-card-title>{{doc.doc_name}}</mat-card-title>
    <mat-card-subtitle>{{doc.doc_type}}</mat-card-subtitle>
  </mat-card-header>
  <mat-divider></mat-divider>
  <mat-card-content>
    <div class="mat-card-dynamic-content" [ngSwitch]="selectedView">
      <!-- Text View -->
      <div *ngSwitchCase="'textView'" class="scrollable-content">
        <p *ngFor="let sent of doc.sents">
          {{sent.getText()}}
        </p>
      </div>
      <!-- IU View -->
      <div *ngSwitchCase="'iuView'" class="card-content-with-toolbar">
        <!-- IU MODE -->
        <div class="scrollable-content" *ngIf="bubbleMode=='iu'">
          <mat-chip-list
            aria-label="sentence chips" class="iu-bubbles">
            <ng-template ngFor let-seg [ngForOf]="doc.segs">
              <ng-template [ngIf]="seg.type=='ghost'" [ngIfElse]="ghostElse">
                <mat-chip color="ghost-bubble" (click)="bubbleClick(seg)" [selected]="seg.selected">
                  {{seg.getText(true)}}
                </mat-chip>
              </ng-template>
              <ng-template #ghostElse>
                <mat-chip color="primary" (click)="bubbleClick(seg)" [selected]="seg.selected" [ngClass]="{
                  'disc-iu' : seg.iu.disc
                }">
                  {{seg.getText(true)}}
                </mat-chip>
              </ng-template>
            </ng-template>
          </mat-chip-list>
        </div>
        <!-- WORD MODE -->
        <div class="scrollable-content" *ngIf="bubbleMode=='word'">
          <mat-chip-list
            aria-label="sentence chips" class="word-bubbles">
            <ng-template ngFor let-seg [ngForOf]="doc.segs">

                <ng-template [ngIf]="seg.iu.label==selected_iu" [ngIfElse]="notSelected">

                    <mat-chip
                      *ngFor="let word of seg.words" [color]="word.color" [selected]="word.selected" (click)="wordClick(word)">
                      {{word.text}}
                    </mat-chip>
                </ng-template>
                <ng-template #notSelected>

                  <ng-template [ngIf]="seg.type=='ghost'" [ngIfElse]="ghostEditElse">
                    <mat-chip color="ghost-bubble" selected="true">
                      <div *ngFor="let word of seg.words" (click)="wordClick(word)" [ngStyle]="{'color':(addWordSet.includes(word)?'red':'black')}">{{word.text}}&nbsp;</div>
                    </mat-chip>
                  </ng-template>
                  <ng-template #ghostEditElse>
                    <mat-chip color="primary" selected="true" [ngClass]="{
                      'disc-iu' : seg.iu.disc
                    }">
                      <div *ngFor="let word of seg.words" (click)="wordClick(word)" [ngStyle]="{'color':(addWordSet.includes(word)?'red':'black')}">{{word.text}}&nbsp;</div>
                    </mat-chip>
                  </ng-template>
                </ng-template>
            </ng-template>
          </mat-chip-list>
          <!--
          <mat-chip-list
            aria-label="sentence chips" class="word-bubbles">
            <mat-chip
              *ngFor="let word of doc.words" [color]="word.color" [selected]="word.selected" (click)="wordClick(word)">
              {{word.text}}
            </mat-chip>
          </mat-chip-list>
          -->
        </div>
        <div>
          <mat-divider></mat-divider>
          <div class="card-toolbar vertical-center" *ngIf="bubbleMode=='iu'">
            <button mat-flat-button color="accent"
            [disabled]="!allowIuEdit" (click)="engageEditIuMode()">
              Edit IU  <mat-icon>create</mat-icon>
            </button>
            <!--
            <button mat-flat-button color="primary" [disabled]="!allowIuEdit">
              Create IU  <mat-icon>add_comment</mat-icon>
            </button>
            -->
          </div>
          <div class="card-toolbar vertical-center save-theme" *ngIf="bubbleMode=='word'">
            <div class="expanding">
              <button mat-flat-button color="primary" class="save-cancel-btn" (click)="iuEditSave()">
                Save  <mat-icon>save</mat-icon>
              </button>
            </div>
            <button mat-flat-button color="accent" class="save-cancel-btn" (click)="iuEditCancel()">
              Cancel  <mat-icon>close</mat-icon>
            </button>
          </div>
        </div>
      </div>
      <!-- Edit text View -->
      <div *ngSwitchCase="'editTextView'" class="card-content-with-toolbar">
        <div class="vertical-center horizontal-center">
        <mat-form-field appearance="outline" class="input-field">
          <textarea cols="260" matInput class="edit-text-field">{{doc.getText()}}</textarea>
        </mat-form-field>
        </div>
        <div>
          <mat-divider></mat-divider>
          <div class="card-toolbar horizontal-center vertical-center">
            <button mat-flat-button color="primary">
              Upload modified text
            </button>
          </div>
        </div>
      </div>
      <!-- Link IU View -->
      <div *ngSwitchCase="'linkIuView'" class="card-content-with-toolbar">
        <div class="scrollable-content">
          <mat-chip-list
            aria-label="sentence chips" class="link-theme">
            <ng-template ngFor let-seg [ngForOf]="doc.segs">
              <!-- the IU is linked to something else -->
              <div [ngSwitch]="seg.doc.doc_type">
                <div *ngSwitchCase="'summary'">
                  <!-- If a summary IU has ANY links color it green -->
                  <ng-template [ngIf]="seg.iu.linkedIus.length > 0" [ngIfElse]="notLinked">
                    <ng-template [ngIf]="seg.selected" [ngIfElse]="summaryLinkNotSelected">
                      <mat-chip color="linked-link" (click)="linkClick(seg)" selected="true">
                        {{seg.getText(true)}}
                      </mat-chip>
                    </ng-template>
                    <ng-template #summaryLinkNotSelected>
                      <mat-chip color="linked-link-selected" (click)="linkClick(seg)" selected="true">
                        {{seg.getText(true)}}
                      </mat-chip>
                    </ng-template>
                  </ng-template>
                </div>

                <div *ngSwitchCase="'source'">
                  <!-- if the input iu is inside the links of a source IU color it green -->
                  <ng-template [ngIf]="seg.iu.linkedIus.includes(this.iuLinkInput)" [ngIfElse]="notLinked">
                    <ng-template [ngIf]="seg.selected" [ngIfElse]="sourceLinkNotSelected">
                      <mat-chip color="linked-link" (click)="linkClick(seg)" selected="true">
                        {{seg.getText(true)}}
                      </mat-chip>
                    </ng-template>
                    <ng-template #sourceLinkNotSelected>
                      <mat-chip color="linked-link-selected" (click)="linkClick(seg)" selected="true">
                        {{seg.getText(true)}}
                      </mat-chip>
                    </ng-template>
                  </ng-template>
                </div>
              </div>
              <!-- CASCADING ELSES
              (these won't be printed if the prev bloc is true) -->
              <ng-template #notLinked>
                <ng-template [ngIf]="seg.iu.suggested" [ngIfElse]="notSuggested">
                  <mat-chip color="suggested-link" (click)="linkClick(seg)" [selected]="seg.selected">
                    {{seg.getText(true)}}
                  </mat-chip>
                </ng-template>
                <ng-template #notSuggested>
                  <ng-template [ngIf]="seg.type=='ghost'" [ngIfElse]="ghostElse">
                    <mat-chip color="ghost-bubble" (click)="linkClick(seg)" [selected]="seg.selected">
                      {{seg.getText(true)}}
                    </mat-chip>
                  </ng-template>
                  <ng-template #ghostElse>
                    <mat-chip color="primary" (click)="linkClick(seg)" [selected]="seg.selected" [ngClass]="{
                      'disc-iu' : seg.iu.disc
                    }">
                      {{seg.getText(true)}}
                    </mat-chip>
                  </ng-template> <!-- Ghostelse -->
                </ng-template> <!-- Not Suggested -->
              </ng-template><!-- Not Linked -->
            </ng-template><!-- NGFor -->
          </mat-chip-list>
        </div>
        <div>
          <mat-divider></mat-divider>
          <div class="card-toolbar vertical-center" *ngIf="bubbleMode=='iu'">
            <button mat-flat-button color="accent"
            [disabled]="!allowIuEdit" (click)="false">
              Button  <mat-icon>create</mat-icon>
            </button>
          </div>
        </div>
      </div>

    </div>

    <!--
    <mat-tab-group class="doc-viewer-mat-tab">
      <mat-tab label="Plain text">

      </mat-tab>
      <mat-tab label="Idea Units">


      </mat-tab>
    </mat-tab-group>
    -->
  </mat-card-content>
  <!--
  <ng-template
    cdkConnectedOverlay
    [cdkConnectedOverlayOrigin]="spinnerOrigin"
    [cdkConnectedOverlayOpen]="showSpinner"
    [cdkConnectedOverlayPositionStrategy]="PositionStrategy"
  >
    <app-load-overlay></app-load-overlay>
  </ng-template>
  -->
</mat-card>
</div>
